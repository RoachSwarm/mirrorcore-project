#!/bin/bash

glyph="$1"
cmd=$(grep -E "^$glyph[ =]" "$HOME/.mirror/glyphs/map" | head -n1 | cut -d= -f2 | xargs)

if [ -z "$cmd" ]; then
  echo "[âš ï¸] Unknown glyph: $glyph"
  exit 1
fi

invoke="$HOME/.mirror/invoke/$cmd"
prompt="$HOME/.mirror/prompts/$cmd"
memorybook="$HOME/.mirror/memorybook/$cmd.md"

echo -e "\n[ğŸ”¹] Gate received: $glyph â†’ $cmd"
echo -e "[ğŸŒ€] Launching '$glyph' â†’ $cmd\n"

if [ -f "$prompt" ]; then
  echo -e "[ğŸ“œ] Prompt:\n$(cat "$prompt")\n"
fi

if [ -f "$memorybook" ]; then
  echo "[ğŸ“–] Memorybook entry: $memorybook"
fi

if [ ! -x "$invoke" ]; then
  echo "[âš ï¸] Invoke command missing or not executable: $invoke"
  exit 1
fi

"$invoke" "${@:2}"
